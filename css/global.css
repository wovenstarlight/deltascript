/* #region Constants and globals */
* {
	box-sizing: border-box;
	text-underline-offset: 0.1em;
}
/* Font initialization */
@font-face {
	font-family: "DeltaFont";
	src: url("../assets/fonts/fnt_main_extended.otf");
}
@font-face {
	font-family: "DeltaFont Condensed";
	src: url("../assets/fonts/fnt_main_condensed_extended.otf");
}
@font-face {
	font-family: "OpenDyslexic Mono";
	src: url("../assets/fonts/OpenDyslexicMono-Regular.otf");
}
@font-face {
	font-family: "OpenDyslexic";
	src: url("../assets/fonts/OpenDyslexic-Regular.woff2");
}
:root { /* Global colors and fonts */
	background-color: black;
	color: white;
	line-height: 1.5;
	/* Don't smooth pixels */
	image-rendering: pixelated;

	--maxwidth: 992px;

	--red: #ff0000;
	--blue: #0000ff;
	--yellow: #ffff00;
	--green: #00ff00;
	--white: #fff;
	--black: #000;
	--purple: #800080;
	--maroon: #800000;
	--orange: #ffa040;
	--lightblue: #00aeff;
	--pink: #ff80ff;
	--lightgreen: #80ff80;
	--lightyellow: #ffff80;
	--iceblue: #81c0ff;
	--lightyellow-gacha: #f3e267;
	/* Custom */
	--gray: #aaa;
	/* Character colors, picked off their Dark World sprites */
	/* Light World */
	--kris: #75fbed;
	--susie: #f883d7;
	--ralsei: #4dcc8e;
	--noelle: #ffce32; /* actually this one is Light World */
	--berdly: #46b3fb;
	--toriel: #7e76a8; /* lightened for readability from #5e5492 */
	--asgore: #e4ba00;
	--sans: #4782c9;
	--papyrus: #ff4711;
	--undyne: #6299c1;
	--alphys: #fdc748;
	--mettaton: #fa0ef3;
	--rudy: #d76551;
	--carol: #00a2e8;
	/* Chapter 1 */
	--lancer: #78ade1; /* lightened for readability from #406080 */
	--king: #5585bd; /* King uses the same sprite palette as Lancer so this one's actually taken from Lancer's bucket LMAO */
	--rouxls: #637de3; /* CUSTOM-PICKED, NOT FROM SPRITE; lightened for readability from #0f0062 */
	--seam: #8482b5;
	--jevil: #8a95c8; /* mixed for readability from #6d6dc0 and #a6bdd0 */
	--jigsawjoe: #46c8ff;
	/* Chapter 2 */
	--queen: #00a2e8;
	--sweet: #e9c040;
	--capn: #4092cc;
	--kk: #5bc762;
	--addison-orange: #ffc90e;
	--addison-blue: #81c9f9;
	--addison-pink: #ffaec9;
	--addison-yellow: #fff200;
	--swatch: #fe758a;
	--swatchling-red: #ed1c24;
	--swatchling-orange: #dd7001;
	--swatchling-yellow: #fff000;
	--swatchling-green: #15bc2e;
	--swatchling-blue: #5f80ff; /* lightened for readability from #1c48f5 */
	/* Chapter 3 */
	--tenna: #da1f52;
	--lanino: #fcce6c;
	--elnina: #9bc3fe;
	--eram: #f26522;
	/* Chapter 4 */
	--gerson: #65aa26;

	--font-base: "DeltaFont", "Courier New", Courier, monospace;
	--font-condensed: "DeltaFont Condensed", var(--font-base);
	--font-tiny: "DeltaFont Tiny", var(--font-base);
	--font-sans: "DeltaFont Comic Sans", var(--font-base);
	--font-dotum: "DeltaFont Dotum", var(--font-base);
	--font-8bit: "DeltaFont 8-Bit", var(--font-base);
	--font-prophecy: "DeltaFont Prophecy", var(--font-base);
	--font-tv: "DeltaFont TV", var(--font-base);

	--prophecy-size: 40em;
}
/* Dim colors */
body.dim {
	--red: #bb0000;
	--blue: #0000bb;
	--yellow: #bbbb00;
	--green: #00bb00;
	--white: #bbb;
	--gray: #777;
	--black: #000;
	--purple: #5e005e;
	--maroon: #5e0000;
	--orange: #b6722e;
	--lightblue: #0077af;
	--pink: #bb5ebb;
	--lightgreen: #5ebb5e;
	--lightyellow: #bbbb80;

	--kris: #169fb5; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--susie: #af67af; /* from Light World sprite */
	--ralsei: #429e76;
	--noelle: #cf9e00; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--berdly: #558ed5; /* from Light World sprite */
	--toriel: #5e5492;
	--jevil: #6d6dc0;
	--jigsawjoe: #0096d7;
	--sweet: #bb941a; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--addison-orange: #c39800; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--addison-blue: #5ea0cc; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--addison-pink: #d07c98; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--addison-yellow: #ada400; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--swatch: #b6608a;
	--swatchling-red: #9A2151;
	--swatchling-orange: #9C4F01;
	--swatchling-yellow: #BC9F07; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--swatchling-green: #1C8920;
	--swatchling-blue: #4067ff; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--lanino: #b89d64; /* CUSTOM-PICKED, NOT FROM SPRITE */
	--elnina: #7497ca; /* CUSTOM-PICKED, NOT FROM SPRITE */
}
/* #region Color-specific classes */
.cR, .red { color: var(--red) }
.cB, .blue { color: var(--blue) }
.cY, .yellow { color: var(--yellow) }
.cG, .green { color: var(--green) }
.cW, .white { color: var(--white) }
.cX, .black {
	color: var(--black);
	:is([theme=eightbit], [theme="8bit"]) &::selection,
	&:is(
		[font=eightbit], [font="8bit"],
		.fnt-eightbit, .fnt-8bit,
	)::selection {
		background-color: var(--kris);
		color: var(--black);
	}
}
.cP, .purple { color: var(--purple) } /* unused */
.cM, .maroon { color: var(--maroon) } /* unused */
.cO, .orange { color: var(--orange) }
.cA, .lightblue { color: var(--lightblue) }
.cS, .pink { color: var(--pink) }
.cV, .lightgreen { color: var(--lightgreen) }
.cI, .iceblue { color: var(--iceblue) }
.gray { color: var(--gray) }
.lightyellow { color: var(--lightyellow) }
.lightyellow-gacha { color: var(--lightyellow-gacha) }
/* Dark World 3D effect */
d-box[theme=dark],
d-box[theme=battlemenu],
[theme=shopleft], [theme=shopright] {
	text-shadow: 1px 1px #03037d;

	.cR, .red,
	.cB, .blue,
	.cY, .yellow,
	.cG, .green,
	.cX, .black,
	.cP, .purple,
	.cM, .maroon,
	.cO, .orange,
	.cA, .lightblue,
	.cS, .pink,
	.cV, .lightgreen,
	.cI, .iceblue,
	.gray, .lightyellow {
		text-shadow: none;
		background: var(--mycolor) linear-gradient(rgb(from var(--white) r g b / 0.8), rgb(from var(--mycolor) r g b / 0));
		background-clip: text;
		color: transparent;
		filter: drop-shadow(1px 1px rgb(from var(--mycolor) r g b / 0.4));
	}
	.cR, .red { --mycolor: var(--red) }
	.cB, .blue { --mycolor: var(--blue) }
	.cY, .yellow { --mycolor: var(--yellow) }
	.cG, .green { --mycolor: var(--green) }
	.cX, .black { --mycolor: var(--black) }
	.cP, .purple { --mycolor: var(--purple) }
	.cM, .maroon { --mycolor: var(--maroon) }
	.cO, .orange { --mycolor: var(--orange) }
	.cA, .lightblue { --mycolor: var(--lightblue) }
	.cS, .pink { --mycolor: var(--pink) }
	.cV, .lightgreen { --mycolor: var(--lightgreen) }
	.cI, .iceblue { --mycolor: var(--iceblue) }
	.gray { --mycolor: var(--gray) }
	.lightyellow { --mycolor: var(--lightyellow) }
}
/* Health bar colors */
.health {
	--kris: #01ffff;
	--susie: #ff00ff;
	--ralsei: #01ff00;
	--noelle: #ffff00;
}
/* Menu portait colors */
.menu {
	--kris: #00a2e8;
	--susie: #ea79c8;
	--ralsei: #b5e61d;
	--noelle: #ffff00; /*same as health bar*/
}
.act {
	--kris: var(--lightblue);
	--susie: var(--pink);
	--ralsei: var(--lightgreen);
	--noelle: var(--lightyellow);
}
/* #region Character colors */
.kris { color: var(--kris) }
.susie { color: var(--susie) }
.ralsei { color: var(--ralsei) }
.noelle { color: var(--noelle) }
.berdly { color: var(--berdly) }
.toriel { color: var(--toriel) }
.asgore { color: var(--asgore) }
.sans { color: var(--sans) }
.papyrus { color: var(--papyrus) }
.undyne { color: var(--undyne) }
.alphys { color: var(--alphys) }
.mettaton { color: var(--mettaton) }
.rudy { color: var(--rudy) }
.carol { color: var(--carol) }
/* Chapter 1 */
.lancer { color: var(--lancer) }
.king { color: var(--king) }
.rouxls { color: var(--rouxls) }
.seam { color: var(--seam) }
.jevil { color: var(--jevil) }
.jigsawjoe { color: var(--jigsawjoe) }
/* Chapter 2 */
.queen { color: var(--queen) }
.sweet { color: var(--sweet) }
.capn { color: var(--capn) } 
.kk { color: var(--kk) }
.scc {
	color: transparent;
	background-image: linear-gradient(
		to right,
		var(--sweet) var(--border1),
		var(--capn) var(--border1) var(--border2),
		var(--kk) var(--border2)
	);
	background-clip: text;
	--border1: 32%;
	--border2: 64%;
}
.spamton {
	color: transparent;
	background-image: linear-gradient(to right, var(--addison-pink), var(--addison-yellow));
	background-clip: text;
}
.addison {
	&.o { color: var(--addison-orange) }
	&.b { color: var(--addison-blue) }
	&.p { color: var(--addison-pink) }
	&.y { color: var(--addison-yellow) }
}
.swatch { color: var(--swatch) }
.swatchling {
	&.r { color: var(--swatchling-red) }
	&.o { color: var(--swatchling-orange) }
	&.y { color: var(--swatchling-yellow) }
	&.g { color: var(--swatchling-green) }
	&.b { color: var(--swatchling-blue) }
}
/* Chapter 3 */
.tenna { color: var(--tenna) }
.lanino { color: var(--lanino) }
.elnina { color: var(--elnina) }
.weather {
	color: transparent;
	background-image: linear-gradient(
		to right,
		var(--lanino) 20%,
		var(--elnina) 80%
	);
	background-clip: text;
}
.eram { color: var(--eram) }
.knight, .titan {
	color: var(--black);
	/* 2 pixels in each cardinal direction, then 1/1 pixel in each intercardinal direction */
	text-shadow:
		0 2px var(--white),		/* N */
		1px 1px var(--white),	/* NE */
		2px 0 var(--white),		/* E */
		1px -1px var(--white),	/* SE */
		0 -2px var(--white),	/* W */
		-1px -1px var(--white),	/* SW */
		-2px 0 var(--white),	/* S */
		-1px 1px var(--white);	/* NW */
}
/* Chapter 4 */
.gerson { color: var(--gerson) }
/* #endregion */
/* #endregion */
/* #region Font-specific classes */
.fnt-condensed { font-family: var(--font-condensed) }
.fnt-tiny { font-family: var(--font-tiny) }
.fnt-sans { font-family: var(--font-sans) }
.fnt-combat {
	font-family: var(--font-dotum);
	body.dyslexic & { font-weight: bold }
}
.fnt-eightbit, .fnt-8bit {
	font-family: var(--font-8bit);
	text-underline-offset: 0.25ch;
	text-decoration-thickness: 0.1ch;
}
.fnt-tv {
	color: var(--red);
	font-family: var(--font-tv);
}
/* #endregion */
h1, h2, h3, h4, h5, h6 {
	font-weight: normal;
	font-family: var(--font-condensed);
}
h2, h3, h4, h5, h6 {
	margin-block: 0.7rem;
	&:first-child { margin-block-start: 0 }
}
h3, h4, h5, h6 {
	--adjacent-spacing: 0.3rem;
	body:not(.compact) :is(d-box, d-choices) + & { margin-block-start: var(--adjacent-spacing) }
	body:not(.compact) &:has(+ d-box, + d-choices) { margin-block-end: var(--adjacent-spacing) }
}
h4, h5, h6 { padding-inline-start: 0.8rem }
h1 { font-size: 2.5em }
h2 {
	font-size: 2em;
	background-color: var(--black);
	border: 0.2rem solid;
	width: fit-content;
	padding: 0.1em 0.4em;
}
h3 { font-size: 2em }
h4 {
	font-size: 1.5em;
	border-inline-start: 0.2rem solid;
}
h5 {
	font-size: 1.2em;
	border-inline-start: 0.2rem double;
}
h6 {
	font-size: 1em;
	color: color-mix(in srgb, var(--white), var(--gray));
	border-inline-start: 0.15rem dotted;
}
.d-section:target h2:first-child, :is(h2, h3, h4, h5, h6):target, .profile:target h3 {
	animation: 1s ease-in-out 0.4s flash;
}
@keyframes flash {
	50% { color: var(--orange) }
}
/* General text */
p, ul, ol { margin-block: 0.5em }
li { margin-block: 0.2em }
p, ul, ol, li {
	&:first-child { margin-block-start: 0 }
	&:last-child { margin-block-end: 0 }
}
p:empty {
	min-height: 1em;
	margin-block: 0;
}
li > :is(ul, ol) { margin-block-start: 0 }
a { /* Global links */
	color: var(--white);
	text-decoration: 0.1em solid underline;

	/* Yellow on hover */
	&:hover, &:focus-within { color: var(--lightyellow) }
	/* â€¦unless it's already yellow, in which case - Orange on hover */
	&:is(#sitehead .currentpage, .lightyellow, .noelle.act):is(:hover, :focus-within) { color: var(--orange) }
}
hr {
	max-width: 100%;

	&:not([class]) {
		border: none;
		position: relative;
		margin-block: 2em;
		overflow: visible;
		width: 100%;
		height: 0.2em;
		background: linear-gradient(to right, var(--white) calc(50% - 3em), transparent calc(50% - 2em) calc(50% + 2em), var(--white) calc(50% + 3em));

		&::before {
			content: "";
			display: block;
			width: 2em;
			height: 2em;
			background: url("/deltascript/assets/images/savepoint.png") center / contain no-repeat;
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
		}

		body:not(.noanim) &::before { background-image: url("/deltascript/assets/images/savepoint.gif") }
	}

	&.hrhalf {
		color: var(--gray);
		margin-inline-start: 0;
		margin-block: 1em;
	}

	&.hr2, &.hr3 {
		color: var(--gray);
		width: calc(var(--basewidth) + 11em);
		margin-inline-start: 0;
		margin-block: 1em;
	}

	&.hr3 { border-style: dashed }
}
d-box:not(:state(compact)) .text-center-expand,
.text-center { text-align: center }
d-box:not(:state(compact)) .block-center-expand,
.block-center { justify-self: center }
d-box:not(:state(compact)) .text-right-expand,
.text-right { text-align: right }
d-box:not(:state(compact)) .block-right-expand,
.block-right { justify-self: right }
img {
	max-width: 100%;
	&.box-width {
		display: block;
		width: 30em;
		padding-inline: min(2.25em, 3.5vw);

		body.compact & { margin-block: 0.5em }
	}
}
/* #region Shaky text effect */
@keyframes shake {
	0% { transform: var(--shake-state-1) }
	33% { transform: var(--shake-state-2) }
	66% { transform: var(--shake-state-3) }
	100% { transform: var(--shake-state-1) }
}
/* Do NOT break in the middle of a word.
 * Limitations: Now you gotta make bordering punctuation shake too otherwise it's prone to breaking weird */
.shake {
	display: inline-flex;
	flex-wrap: wrap;
	text-indent: 0;
}
body:not(.noanim) .shake span, body:not(.noanim) d-text[effect*=shake][asterisk]::before {
	animation-name: shake;
	animation-duration: 0.2s;
	animation-timing-function: steps(2, jump-none);
	animation-iteration-count: infinite;
	animation-delay: -0.45s;
}
body.noanim .shake span, body.noanim d-text[effect*=shake][asterisk]::before {
	font-style: italic;
}
.shake .s1, d-box:nth-of-type(3n) d-text[effect*=shake][asterisk]::before {
	--shake-state-1: translate(calc(var(--intensity, 1) * 3.2%), calc(var(--intensity, 1) * -3.2%));
	--shake-state-2: translate(calc(var(--intensity, 1) * 2.2%), calc(var(--intensity, 1) * 0%));
	--shake-state-3: translate(calc(var(--intensity, 1) * -4%), calc(var(--intensity, 1) * 3.6%));
}
.shake .s2, d-box:nth-of-type(3n+1) d-text[effect*=shake][asterisk]::before {
	--shake-state-1: translate(calc(var(--intensity, 1) * -0.6%), calc(var(--intensity, 1) * 3.9%));
	--shake-state-2: translate(calc(var(--intensity, 1) * -3.2%), calc(var(--intensity, 1) * -1.4%));
	--shake-state-3: translate(calc(var(--intensity, 1) * 4.8%), calc(var(--intensity, 1) * -1.2%));
}
.shake .s3 {
	--shake-state-1: translate(calc(var(--intensity, 1) * 4.4%), calc(var(--intensity, 1) * 3.5%));
	--shake-state-2: translate(calc(var(--intensity, 1) * -3.8%), calc(var(--intensity, 1) * 1.8%));
	--shake-state-3: translate(calc(var(--intensity, 1) * 2.2%), calc(var(--intensity, 1) * 3%));
}
.shake .s4, d-box:nth-of-type(3n+2) d-text[effect*=shake][asterisk]::before {
	--shake-state-1: translate(calc(var(--intensity, 1) * 4.8%), calc(var(--intensity, 1) * -0.2%));
	--shake-state-2: translate(calc(var(--intensity, 1) * -3.5%), calc(var(--intensity, 1) * -0.2%));
	--shake-state-3: translate(calc(var(--intensity, 1) * -4.2%), calc(var(--intensity, 1) * -4.6%));
}
d-text[effect*=shake][asterisk] {
	text-indent: -1ch;
	&::before { display: inline-block }
}
[effect~=shake-veryslight] { --intensity: 0.35 }
[effect~=shake-slight] { --intensity: 0.65 }
[effect~=shake-hard] { --intensity: 1.8 }
/* #endregion */
/* Chromatic aberration (color bleed) effect */
[effect~=bleed] { filter: url(#kill) }
/* Code/variables formatting */
code {
	font-family: 'Courier New', Courier, monospace;
	font-weight: bold;
	border: thin solid rgb(from currentColor r g b / 0.3);
	border-radius: 0.2em;
	background-color: var(--black);
	padding: 0.1em 0.2em;
	margin-inline: 0.2em;
	display: inline-block;
}
/* Shrink text on small screens */
@media (max-width: 30rem) {
	body { font-size: 0.875em }
	#main h1 { hyphens: auto }
}
/* #endregion */

/* #region Accessibility */
/* Skip to main content link */
#skip {
	/* Placement */
	position: fixed;
	top: 0.5em;
	left: 50%;
	transform: translate(-50%);
	/* Display */
	border: var(--border-width) solid transparent;
	border-image: url("../assets/images/ui/textbox/light.png") 16 / var(--border-width);
	body.dim & { border-image-source: url("../assets/images/ui/textbox/light_dim.png") }
	background-clip: padding-box;
	background-color: var(--black);
	line-height: 1;
	text-decoration: none;
	z-index: 5;

	&:hover, &:focus-within { color: var(--yellow) }

	&:not(:hover, :focus-within) { /* Place it above visible screen */
		transform: translate(-50%, calc(-100% - (2 * var(--border-width) + 1em)));
	}
}
/* Hide from sight but not screen readers */
.visually-hidden,
header.d-section:has(h1.visually-hidden:only-child) {
	position: fixed;
	top: -2em;
	left: 0;
	font-size: 1em;
	margin: 0 !important;
	padding: 0 !important;
	white-space: pre; /* Prevent text wrapping into visibility */
	clip-path: xywh(0 0 0 0);
}
/* "Go back" link on 404 pages */
#back404 {
	width: calc(100% - (2 * var(--border-width)));
	margin: var(--border-width);
	border-image: url("../assets/images/ui/textbox/light.png") 16 / var(--border-width) / var(--border-width);
	body.dim & { border-image-source: url("../assets/images/ui/textbox/light_dim.png") }
	background-color: var(--black);
	color: var(--white);
	font: inherit;
	text-align: center;
	cursor: pointer;

	&:hover, &:focus { color: var(--yellow) }
}
/* #region Settings */
#menu {
	position: fixed;
	bottom: 0;
	right: 0;
	z-index: 5;
	padding: min(0.75em, 2vmax);
	display: flex;
	flex-direction: column-reverse;
	align-items: flex-end;
}
#openmenu {
	color: inherit;
	font: inherit;
	border: none;
	padding: 0;
	background-color: transparent;
	width: fit-content;
	height: fit-content;
	cursor: pointer;

	&:is(:hover, :focus) .inactive, &:has(+ #menucontents:not([hidden])) .inactive,
	&:not(:hover, :focus, &:has(+ #menucontents:not([hidden]))) .active { display: none }
	img {
		display: block;
		height: 4em;
	}
}
#menucontents {
	width: calc(100vw - 3em);
	max-width: 17em;
	margin: var(--border-width) calc(var(--border-width) - 0.25em);
	background-color: var(--black);
	border-image: url("../assets/images/ui/textbox/light.png") 16 / var(--border-width) / var(--border-width);
	body.dim & { border-image-source: url("../assets/images/ui/textbox/light_dim.png") }

	a { text-decoration: none }
	button {
		background-color: transparent;
		border: none;
		color: inherit;
		font: inherit;
	}

	a, label, button {
		display: block;
		padding: 0.25em 1em;
		position: relative;

		&:hover, &:focus-within {
			color: var(--yellow);
			cursor: pointer;
		}

		&:not([disabled])::before {
			content: "";
			--size: 0.75em;
			width: var(--size);
			height: var(--size);
			background: url("../assets/images/heart.png") center / contain no-repeat;
			background-size: contain;
			position: absolute;
			right: 100%;
			margin-inline-end: -0.95ch;
			top: 0.6em;
		}

		&:not(:hover)::before { content: unset }
	}

	label.toggle {
		display: grid;
		grid-template-columns: 1fr 3ch;
		gap: 3ch;

		&::after { content: "OFF" }
		&:has(input:checked)::after { content: "ON" }

		&.gray { cursor: help }
	}

	button[disabled] {
		color: var(--gray);
		cursor: help;
	}
}
/* #endregion */
/* Toggling animated images */
body:not(.noanim) img.animswitch[src$=".png"],
body.noanim img.animswitch[src$=".gif"] {
	display: none;
}
/* #endregion */

/* #region Layout */
body {
	/* Visuals */
	background: var(--black) url("../assets/images/bg.png") center repeat fixed;
	color: var(--white);
	/* Font */
	font-family: var(--font-base);
	--border-width: 1.2rem;
	--baseheight: 6.5em;
	--basewidth: 24.4em;

	&.dyslexic {
		--font-base: "OpenDyslexic Mono", "DeltaFont", "Courier New", Courier, monospace;
		--font-condensed: "OpenDyslexic", "DeltaFont Condensed", var(--font-base);
		--font-tiny: "OpenDyslexic Mono", "DeltaFont Tiny", var(--font-base);
		--font-sans: "OpenDyslexic Mono", "DeltaFont Comic Sans", var(--font-base);
		--font-dotum: "OpenDyslexic Mono", "DeltaFont Dotum", var(--font-base);
		--font-8bit: "OpenDyslexic Mono", "DeltaFont 8-Bit", var(--font-base);
		--font-prophecy: "OpenDyslexic", "DeltaFont Prophecy", var(--font-base);
		--font-tv: "OpenDyslexic Mono", "DeltaFont TV", var(--font-base);
		font-size: 0.91em;
		--basewidth: 26.6em;
		--baseheight: 6.6em;
	}

	/* Normalize */
	margin: 0;
	min-height: 100vh;

	/* Layout */
	display: grid;
	grid-template-rows: auto 1fr auto;
}
#sitehead, #sitefoot {
	padding-inline: calc(1em + ((100vw - var(--maxwidth)) / 2));
	padding-block: 0.5em;
	background-color: var(--black);

	a.currentpage { color: var(--yellow) }
	a:not(.currentpage, :hover, :focus) { text-decoration: none }
}
/* Header */
#sitehead {
	text-align: center;
}
#logo {
	font-size: 2em;
	margin: 0.25em 0.5em;
}
#sitenav {
	display: flex;
	flex-flow: row wrap;
	gap: 0.2em min(3em, 5vw);
	justify-content: center;
}
/* Content */
#main {
	justify-self: center;
	width: 100vw;
	max-width: var(--maxwidth);
	display: flex;
	flex-direction: column;
	gap: 1em;

	/* Style only those sections that have something visible within them */
	.d-section:not(:has(> :only-child.visually-hidden)) {
		padding: 1em min(1em, 3vw);

		/* Initialize positioning */
		position: relative;
		z-index: 0;

		/* Normal sections have no cutoff at the top */
		--top-offset: 0em;

		/* ::before acts as background, so that the actual d-section box still contains the heading */
		&::before {
			content: "";
			display: block;
			position: absolute;
			bottom: 0;
			left: 0;
			width: 100%;
			height: calc(100% - var(--top-offset));
			background-color: rgb(from var(--black) r g b / 0.6);
			backdrop-filter: blur(5px);
			z-index: -1;
		}

		/* If there's a heading, add cutoff at the top for the background, so the heading overlays the section's edge
		 The padding is retained at the top, but margin is used to visually align the top of the heading with the top of where the d-section box would normally be
		 */
		&:has(> h2:first-child) {
			margin-block-start: -1em;
			--top-offset: 3em;
		}
	}

	h1 {
		text-align: center;
		margin: 0;

		&:not(:last-child) {
			border-block-end: 0.1em solid rgb(from var(--gray) r g b / 0.1);
		}
	}
}
#pagecred, #pagedesc, #pagesrc, #pagetoc, #pageseealso {
	margin-block: 0.5em;
	&:last-child { margin-block-end: 0 }
}
#pagesrc, #pagetoc, #pageseealso {
	border: calc(var(--border-width) * 0.5) solid transparent;
	border-image: url("../assets/images/ui/textbox/light_transparent.png") 16 / var(--border-width) / calc(0.25 * var(--border-width));
	body.dim & { border-image-source: url("../assets/images/ui/textbox/light_transparent_dim.png") }

	summary {
		cursor: pointer;
		display: block;
		position: relative;
		padding-inline-start: 1.2em;

		&::before {
			content: "";
			background: center / contain no-repeat;
			width: var(--size);
			height: var(--size);
			position: absolute;
			left: 0;
			top: calc(50% - (0.55 * var(--size)));
			--size: 0.75em;
		}
	}
	&[open] summary, summary:hover, summary:focus {
		color: var(--yellow);
		&::before { background-image: url("../assets/images/heart.png") }
	}
}
#pagecred {
	color: var(--gray);
	font-size: 0.9em;
}
#pagesrc .code {
	font-family: "Courier New", Courier, monospace;
	font-weight: bold;
	word-break: break-word;
}
#pagesrc a:not([href]) {
	text-decoration-style: dotted;
	cursor: not-allowed;
}
#pagetoc {
	ol { counter-reset: toc }
	li {
		font-family: var(--font-condensed);
		letter-spacing: 0.125ch;
		counter-increment: toc;
		&::marker {
			content: counters(toc, ".") ".  ";
		}
		ol { margin-block-start: 0.2em }
	}
}
/* Footer */
#sitefoot {
	display: flex;
	justify-content: space-between;
	flex-wrap: wrap;
	text-align: center;

	p {
		margin: 0;
		padding-inline: 0.75em;
		flex-grow: 1;
	}
}
/* #endregion */

/* #region Annotations and other custom styles*/
.note {
	color: var(--gray);
	--adjacent-spacing: 1em;
	body:not(.compact) :is(d-box, d-choices, d-option-panel) + & { margin-block-start: var(--adjacent-spacing) }
	body:not(.compact) &:has(+ d-box, + d-choices, + d-option-panel) { margin-block-end: var(--adjacent-spacing) }
	&:first-child, .selection-label + & { margin-block-start: 0 }
	&:last-child { margin-block-end: 0 }

	a:not(.kris, .susie, .ralsei, .noelle, :hover, :focus) { color: inherit }
}
/* Forced line break */
body:not(.compact) .break {
	display: block;
	&.double { min-height: 1.292em }
}
/* Quiz correct answer marker */
.quizcorrect {
	cursor: help;
	width: 1.2ch;
	vertical-align: -0.25ch;
	margin-inline-start: -0.25ch;
}
/* #endregion */

/* #region Game styles */
/* Dialogue boxes and choice menus */
d-box, d-choices {
	&:not(:state(compact)) {
		/* Space out
		 * Increase spacing between neighboring boxes to account for border outset */
		margin: 0.2em 0.5em;
		:is(p, ul, ol) + & { margin-block-start: 0.5em }
		&:has(+ h2, + h3, + h4, + h5, + h6) { margin-block-end: 1em }

		padding: 0.1em 0.2em;
		font-size: 1.2em;
		body.dyslexic &:not(
			[theme=objreact],
			[theme^=battletalk],
			[theme=caller]
		) { font-size: 1.3186em }
		line-height: 1;
		min-height: var(--baseheight);
		width: var(--basewidth);
		max-width: calc(100% - var(--border-width));
		background-color: var(--black);
		background-clip: padding-box;
		border: var(--border-width) solid transparent;
		border-image: url("../assets/images/ui/textbox/light.png") 16 / var(--border-width);
		body.dim &:not([theme]), body.dim &[theme=light] { border-image-source: url("../assets/images/ui/textbox/light_dim.png") }

		&[theme=dark], &[theme^=power], &[theme^=shop], &[theme=save] {
			border-image-source: url("../assets/images/ui/textbox/dark.gif");
			body.dim & { border-image-source: url("../assets/images/ui/textbox/dark_dim.gif") }
		}

		&[theme=plain],
		&[theme^=obj],
		&[theme=battlemenu], &[theme=battledesc],
		&[theme=eightbit], &[theme="8bit"] {
			border-image-source: url("../assets/images/ui/textbox/plain.png");
			&:has(.hideoverflow, d-box) { clip-path: xywh(0.25em 0.25em calc(100% - 0.5em) calc(100% - 0.5em)) }
		}

		&[theme^=obj], &[theme=battlemenu] { width: calc(var(--basewidth) + 4em) }

		body.dyslexic &[theme^=obj] { width: calc(var(--basewidth) + 10em) }

		&[theme^=obj], &[theme^=power], &[theme=battledesc], &[theme=shopdesc] {
			font-family: var(--font-condensed);
		}

		&[theme=objreact] {
			display: flex;
			align-items: center;
			min-height: unset;
			padding: 0;
			width: calc(var(--basewidth) + 6em);
			body.dyslexic & { width: calc(var(--basewidth) + 12.5em) }

			d-speaker {
				display: block;
				font-size: 0;

				&::before {
					content: "";
					display: block;
					margin: -0.5rem 0;
					--size: 2rem;
					width: var(--size);
					height: var(--size);
					background: center / contain no-repeat;
				}

				&.kris::before { background-image: url("../assets/images/faces/kris/battle.png") }
				&.susie::before { background-image: url("../assets/images/faces/susie/battle.png") }
				&.ralsei::before { background-image: url("../assets/images/faces/ralsei/battle.png") }
				&.noelle::before { background-image: url("../assets/images/faces/noelle/battle.png") }
			}

			d-text { margin-inline-start: 1ch }
		}

		&[theme=powertitle] {
			width: calc(var(--basewidth) - 11.4em);
			position: relative;
			&::before {
				content: "";
				display: block;
				position: absolute;
				top: calc(-0.975 * var(--border-width));
				left: 0;
				width: 100%;
				height: 0.75em;
				background: url("../assets/images/ui/statmenu/char.png") center / contain no-repeat;
			}
			body.dim &::before { background-image: url("../assets/images/ui/statmenu/char_dim.png") }
		}

		&[theme=battlemenu] > d-text { max-width: calc(var(--basewidth) - 2.4em) }
		&[theme=battlemenu] > d-sprite:not([speaker=Tenna]) + d-text { max-width: calc(var(--basewidth) - 6.4em - 1ch) }

		&[theme=battledesc] {
			width: calc(var(--basewidth) - 16.5em);
			color: var(--gray);
			d-text.orange {
				grid-row: 3;
				align-self: end;
			}
		}

		&[theme^=battletalk] {
			min-height: unset;
			height: fit-content;
			width: fit-content;
			margin: 0.5em 1em;
			padding: 0.2em 0.3em;
			display: flex;
			flex-direction: column;
			background-color: var(--white);
			color: var(--black);
			font-size: 1em;
			font-family: var(--font-dotum);
			body.dyslexic & { font-weight: bold }

			d-speaker {
				--lightyellow: color-mix(in srgb, var(--orange), var(--black));
				display: block;
				margin-block-end: 0.4em;

				--kris: #3b4380; /* blended for readability from too-dark DW hair #0b0b3b and too-light DW shadow #6a7bc4 */
				--susie: #88176a;
				--ralsei: #38705e;
				--noelle: #b15d34; /* darkened for readability from LW skintone #d87d50 */
				--berdly: #36394b;
				--lancer: #406080;
				--queen: #1263bc;
				--rouxls: #3620b0; /* CUSTOM-PICKED, NOT FROM SPRITE; lightened for readability from #0f0062 */
				--jigsawjoe: #283f64;
				--jevil: #3c3c97; /* darkened for readbility from #6d6dc0 */
				--sweet: #b69325; /* CUSTOM-PICKED, NOT FROM SPRITE; darkened for readability from #e9c040 */
				--capn: #615eb9; /* CUSTOM-PICKED, NOT FROM SPRITE; darkened for readability from #6c6ab3 */
				--kk: #3e7d4a;
				--addison-pink: #a24b68; /* darkened for readability from #ffaec9 */
				--addison-yellow: #9f9600; /* darkened for readability from #fff200 */
				--lanino: #b45c1c; /* CUSTOM-PICKED, NOT FROM SPRITE; darkened for readability from #fcce6c */
				--elnina: #2f66b7; /* darkened for readability from #9bc3fe */
				--gerson: #3d7a06; /* darkened for readability from #65aa26 */

				body.dim & {
					--sweet: #604800; /* CUSTOM-PICKED, NOT FROM SPRITE; darkened for readability from #e9c040 */
					--capn: #154e75; /* CUSTOM-PICKED, NOT FROM SPRITE; darkened for readability from #6c6ab3 */
					--kk: #1b551f;
					--tenna: #7a223a;
					--lanino: #7b3502; /* CUSTOM-PICKED, NOT FROM SPRITE; darkened for readbility from above*/
					--elnina: #174891; /* CUSTOM-PICKED, NOT FROM SPRITE; darkened for readbility from above*/
				}
			}
		}
		&[theme=battletalk] {
			border-image-source: url("../assets/images/ui/textbox/bubble.png");
			body.dim & { border-image-source: url("../assets/images/ui/textbox/bubble_dim.png") }
			border-image-slice: 6;
			--border-width: 0.375em;
		}
		&[theme=battletalkround] {
			border-image-source: url("../assets/images/ui/textbox/roundbubble.png");
			body.dim & { border-image-source: url("../assets/images/ui/textbox/roundbubble_dim.png") }
			border-image-slice: 10;
			border-width: calc(var(--border-width) - 0.6em);
			text-align: center;
			d-text { line-height: 1.2em }
			/* Positions and colors defined in gml_Object_obj_tennatalkbubble_Draw_0 */
			d-speaker:is(.tenna, .susie, .ralsei, .lancer) ~ d-text {
				text-shadow:
					0 1px rgb(from var(--mycolor) r g b / 0.25),
					1px 1px rgb(from var(--mycolor) r g b / 0.25),
					1px 0 rgb(from var(--mycolor) r g b / 0.25);
			}
			d-speaker.tenna ~ d-text { --mycolor: #ffff00 }
			d-speaker.susie ~ d-text { --mycolor: #830c74 }
			d-speaker.ralsei ~ d-text { --mycolor: #13d26f }
			d-speaker.lancer ~ d-text { --mycolor: #5585bd }
		}

		&[theme=shopleft] { width: calc(var(--basewidth) - 10ch) }

		&[theme=shopright], &[theme=shopdesc] { width: calc(var(--basewidth) - 14.2em) }

		&[theme=shopright] { padding-inline: 0.4em }

		&[theme=fade], &[theme=prophecy] {
			border: unset;
			max-width: calc(100% - 3 * var(--border-width));
			--background-color: var(--black);
			background-color: var(--background-color);

			margin: calc(var(--border-width) + 0.2em) calc(var(--border-width) + 0.5em);
			:is([theme=fade], [theme=prophecy], d-option-panel) + & { margin-block-start: calc((2 * var(--border-width)) + 0.2em) }
			:is(h2, h3, h4, h5, h6, p, ul, ol) + & { margin-block-start: calc(var(--border-width) + 1rem) }
			&:has(+ h2, + h3, + h4, + h5, + h6, + p, + ul, + ol) { margin-block-end: calc(var(--border-width) + 1rem) }
			&:has(+ hr) { margin-block-end: calc(var(--border-width) + 2rem) }
			&:has(
				d-option:nth-child(2):last-child,
				d-option:nth-child(3):last-child,
				d-option:nth-child(4):last-child
			) + d-option-panel + d-option-panel:not([hidden]),
			&:has(
				d-option:nth-child(3):last-child,
				d-option:nth-child(4):last-child
			) + d-option-panel + d-option-panel + d-option-panel:not([hidden]),
			&:has(d-option:nth-child(4):last-child) + d-option-panel + d-option-panel + d-option-panel + d-option-panel:not([hidden]) {
				margin-block-start: 0;
			}

			box-shadow:
				0 0
				calc(0.6 * var(--border-width))	/* blur */
				calc(0.6 * var(--border-width))	/* spread */
				var(--background-color);
		}
		&[theme=fade] {
			width: calc(var(--basewidth) - 2em);
			min-height: calc(var(--baseheight) - 2em);

			&.invert {
				--background-color: var(--white);
				color: var(--black);
			}
		}
		&[theme=prophecy] {
			min-height: unset;
			::selection {
				color: var(--black);
				background-color: var(--iceblue);
			}
		}

		&[theme=caller] {
			--border-width: 1rem;
			border-image-source: url("../assets/images/ui/textbox/spikebubble.png");
			border-image-repeat: stretch round;
			border-image-slice: 12 8;
			min-height: calc(var(--baseheight) + 1em);
			width: fit-content;
			margin: 1em;
			padding: 0.5em 1em;
			display: flex;
			flex-direction: column;
			font-family: var(--font-dotum);
			body.dyslexic & { font-weight: bold }
			font-size: 1em;
		}

		&[theme=eightbit], &[theme="8bit"] {
			width: calc(var(--basewidth) - 4.39em);
			font-family: var(--font-8bit);

			&.quiz {
				background-color: #00a2e8;
				border-image-slice: 12;
				border-image-source: url("../assets/images/ui/textbox/quiz.png");
				body.dim & {
					border-color: #1263bc;
					border-image-source: url("../assets/images/ui/textbox/quiz_dim.png")
				}
				&.doom {
					background-color: #882222;
					border-image-source: url("../assets/images/ui/textbox/quiz_doom.png");
					body.dim & { border-image-source: url("../assets/images/ui/textbox/quiz_doom_dim.png") }
				}
			}
		}

		&[theme=save] {
			margin-inline: auto;
			padding-block: 0;
			display: grid;
			grid-template-columns: 1fr auto auto;
			gap: 0.25em 1.5ch;
			--mywidth: calc(var(--basewidth) - 7em);

			&.savev1 {
				width: var(--mywidth);

				&.saved .option { grid-column: 1 / span 3 }

				.location { margin-block-end: 0.75em }
				.option:nth-child(odd) { margin-inline-start: 2ch }
			}
			&.savev2 {
				width: calc(var(--mywidth) + 3ch);
				.location {
					text-align: center;
					margin-block: 0.75em;
				}
				.option:nth-child(odd) { margin-inline-start: 3.5ch }
			}
			&.savev1, &.savev2 {
				.name, .level, .time { margin-block-start: -0.2em }
				.option:nth-child(even) { grid-column: 2 / span 2 }
				.option:nth-last-child(2) { margin-block-end: -0.2em }
			}

			&.savefull {
				width: calc(var(--mywidth) + 6ch);
				grid-template-columns: 7ch 1fr 7ch;

				hr { max-width: unset }

				d-text:first-child, d-text:nth-child(2), d-text:nth-child(3) { margin-block-start: -0.3em }
				.time { justify-self: end }
				.name, .location, .saved, .blank, .option { justify-self: center }
				.location, .saved, .blank, .option { grid-column: 1 / span 3 }
				.saved, .blank {
					min-height: 3em;
					display: flex;
					align-items: center;
				}
			}
			&.top {
				min-height: unset;
				margin-block-end: 0.5em;

				d-text:last-child { margin-block-end: -0.5em }
			}
			&.bottom {
				.level { margin-inline-start: 2ch }
				.blank::before { top: 1.05em }
			}

			d-text {
				grid-column: unset;
				grid-row: unset;
				&:last-child { margin-block-end: -0.3em }
			}
			.location { grid-column: 1 / span 3 }

			hr {
				--margin: 0.77em;
				margin: 0 calc(-1 * var(--margin));
				width: calc((2 * var(--margin)) + 100%);
			}
		}

		@media (max-width: 30rem) {
			font-size: 1em;
			body.dyslexic &[theme] { font-size: 0.9em }

			/* For boxes with small dialogues, add spacing so dialogue doesn't overlap. ...too much, at least. */
			&:has(d-box) { padding-block-end: 2.25em }
			/* has top>center OR top>bottom/default OR center>bottom/default */
			&:has(d-box[place~=top]):has(d-box[place~=center], d-box[place~=center-y], d-box[place~=bottom], d-box:not([place~=top], [place~=center], [place~=bottom])),
			&:has(d-box[place~=center], d-box[place~=center-y]):has(d-box[place~=bottom], d-box:not([place~=top], [place~=center], [place~=bottom])) { padding-block-end: 3.75em }
			/* has top, center, AND bottom/default */
			&:has(d-box[place~=top]):has(d-box[place~=center], d-box[place~=center-y]):has(d-box[place~=bottom], d-box:not([place~=top], [place~=center], [place~=bottom])) { padding-block-end: 5.5em }
		}

		img {
			&:is(.fullheight, .fullwidth) { display: block }
			&.fullheight {
				height: 100%;
				grid-row: 1 / span 3;
			}
			&.fullwidth {
				width: 100%;
				grid-column: 1 / span 2;

				&.center { justify-self: center }
			}
			&.fullwidth.fullheight { object-fit: contain }
		}

		&:not([theme=objreact], [theme^=battletalk]) {
			&:has(
				> d-speaker.kris,
				> d-speaker.susie,
				> d-speaker.ralsei,
				> d-speaker.noelle
			) {
				position: relative;

				&::before {
					content: "";
					position: absolute;
					top: -0.25em;
					left: -2.1em;
					border: 0.2em solid var(--black);
					--size: 1.75em;
					width: var(--size);
					height: var(--size);
					background: var(--black) center / 80% no-repeat;
					border-radius: 25%;
				}
			}
			&:has(> d-speaker.kris)::before { background-image: url("../assets/images/faces/kris/battle.png") }
			&:has(> d-speaker.susie)::before { background-image: url("../assets/images/faces/susie/battle.png") }
			&:has(> d-speaker.ralsei)::before { background-image: url("../assets/images/faces/ralsei/battle.png") }
			&:has(> d-speaker.noelle)::before { background-image: url("../assets/images/faces/noelle/battle.png") }
		}
		&:is([theme=light], [theme=dark]):has(
			> d-speaker.kris,
			> d-speaker.susie,
			> d-speaker.ralsei,
			> d-speaker.noelle
		)::before {
			border-color: var(--white);
		}
		&[theme=fade]:has(
			> d-speaker.kris,
			> d-speaker.susie,
			> d-speaker.ralsei,
			> d-speaker.noelle
		)::before {
			top: -0.05em;
			left: -1.9em;
			box-shadow: 0 0 0.2em 0.1em var(--black);
			border: none;
		}
	}

	&:state(compact) {
		margin: 0 0 0 min(1em, 3vw);
		gap: 0 0.5ch;
		&:not(:has(d-speaker, d-sprite)) { gap: 0 }
		align-items: baseline;

		/* On smaller screens, stack dialogue instead */
		@media (max-width: 30rem) {
			display: flex;
			flex-direction: column;

			/* ...but only main dialogue! as in, actual spoken dialogue, not wrappers for other d-boxes; leave those ones alone. */
			&:has(> d-speaker, > d-sprite) {
				padding-inline-start: 3vw;
				& > d-speaker, & > d-sprite d-speaker {
					position: relative;
					left: -3vw;
				}
			}

			d-text ~ d-box { padding-inline-start: 3ch }
		}

		&[theme=save] {
			width: fit-content;

			hr { margin-block: 0.5em }
			.option:nth-child(5), &.bottom { margin-block-start: 1em }
		}
	}

	&.glow :is(d-text, d-option) {
		text-shadow:
			0 0.125ch rgb(from currentColor r g b / var(--intensity, 0.15)),
			0.125ch 0 rgb(from currentColor r g b / var(--intensity, 0.15)),
			0 -0.125ch rgb(from currentColor r g b / var(--intensity, 0.15)),
			-0.125ch 0 rgb(from currentColor r g b / var(--intensity, 0.15)),
			0.125ch 0.125ch rgb(from currentColor r g b / var(--intensity, 0.15)),
			-0.125ch -0.125ch rgb(from currentColor r g b / var(--intensity, 0.15)),
			-0.125ch 0.125ch rgb(from currentColor r g b / var(--intensity, 0.15)),
			0.125ch -0.125ch rgb(from currentColor r g b / var(--intensity, 0.15));
			body:not(.noanim) & { animation: glowpulse 1.5s ease infinite alternate-reverse }
	}
	&.space :is(d-text, d-option) { letter-spacing: 0.5ch }

	&[theme=prophecy] {
		text-align: center;
		align-items: center;
	}

	&[theme=save] {
		font-family: var(--font-condensed);

		.option, &.bottom d-text { margin-inline-start: 2ch }

		&:where(.savev1, .savev2):not(.saved) .option:where(
			:nth-child(5):not(:has(~ .option:hover)), /* first option in the menu, by default */
			:hover /* subsequent options, if hovered */
		),
		&.bottom:not(:has(.saved)) :where(
			.level:hover,
			.level:has(+ .name:hover, + .name + .time:hover, + .name + .time + .location:hover),
			.blank:hover,
			.blank:nth-child(6):not(:has(~ :hover)),
			.option:hover
		) {
			position: relative;
			&::before {
				content: "";
				background: url("../assets/images/heart16.png") center / contain no-repeat;
				width: var(--size);
				height: var(--size);
				position: absolute;
				top: 0.25em;
				right: 100%;
				margin-inline-end: 0.5ch;
				--size: 0.7em;
			}
		}

		&.bottom:not(:has(.saved)) :where(
			.level:hover,
			.level:has(+ .name:hover, + .name + .time:hover, + .name + .time + .location:hover),
			.blank:hover,
			.blank:nth-child(6):not(:has(~ :hover)),
			.option:hover
		),
		&.bottom:not(:has(.saved)) :where(
			.level:hover + .name,
			.level:hover + .name + .time,
			.level:hover + .name + .time + .location,
			.name:hover, .time:hover, .location:hover,
			.name:hover + .time,
			.name:hover + .time + .location,
			.time:hover + .location,
			.name:has(+ .time:hover, + .time + .location:hover),
			.time:has(+ .location:hover)
		),
		&.saved, .saved { color: var(--yellow) }

		&.bottom:not(:has(.saved)) d-text:hover ~ .blank{
			color: inherit;
			&::before { content: unset }
		}

		hr {
			grid-column: 1 / span 3;
			border: none;
			background: url("../assets/images/ui/textbox/dark_top.png") center / contain repeat;
			&::before { content: unset }
		}
	}
}
@keyframes glowpulse {
	0% { --intensity: 0.1 }
	10% { --intensity: 0.11 }
	20% { --intensity: 0.12 }
	30% { --intensity: 0.13 }
	40% { --intensity: 0.14 }
	50% { --intensity: 0.15 }
	60% { --intensity: 0.16 }
	70% { --intensity: 0.17 }
	80% { --intensity: 0.18 }
	90% { --intensity: 0.19 }
	100% { --intensity: 0.2 }
}
/* Dialogue boxes only */
d-box {
	display: grid;
	grid-template-columns: auto 1fr;

	&:has(&) { position: relative }

	&:not(:state(compact)) {
		/* Align text towards start */
		grid-template-rows: auto auto 1fr;
		word-break: keep-all;

		d-box {
			position: absolute;
			font-size: 0.6em;
			font-family: var(--font-condensed);
			/* Reset full-size features */
			background-color: transparent;
			border-image: unset;
			border-inline-width: 0;
			margin: 0;
			width: max-content;
			text-shadow: none;
			/* Center content */
			align-items: center;

			d-sprite img { --size: 3.2em }

			d-text:first-of-type { margin-block-start: 0.5em }

			/* Specify placements (defaulting to bottom right) */
			&:not([place]), &:not([place~=bottom], [place~=top]),
			&[place~=bottom] {
				bottom: calc(-2.4em - var(--offset-y, 0em));
			}
			&:not([place]), &:not([place~=right], [place~=left]),
			&[place~=right] {
				right: calc(-1 * var(--offset-x, 0em));
			}
			&[place~=top] {
				top: calc(-2.4em + var(--offset-y, 0em));
			}
			&[place~=left] {
				left: var(--offset-x, 0em);
			}
			d-text[asterisk] + &[place~=left] {
				left: calc(2.08em + var(--offset-x, 0em));
			}
			d-sprite[speaker] ~ &[place~=left] {
				left: calc(8.6em + var(--offset-x, 0em));
			}
			&[place~=center-x] {
				left: calc(50% + var(--offset-x, 0em));
				transform: translateX(-50%);
			}
			&[place~=center-y] {
				top: calc(50% + var(--offset-y, 0em));
				transform: translateY(-50%);
			}
			&[place~=center] {
				left: calc(50% + var(--offset-x, 0em));
				top: calc(50% + var(--offset-y, 0em));
				transform: translate(-50%, -50%);
			}
			d-text[asterisk] + &[place~=center-x],
			d-text[asterisk] + &[place~=center] {
				left: calc(50% + 1.04em + var(--offset-x, 0em));
			}
			d-sprite[speaker] ~ &[place~=center-x],
			d-sprite[speaker] ~ &[place~=center] {
				left: calc(50% + 4.3em + var(--offset-x, 0em));
			}

			@media (min-width: 30rem) {
				&[place~=bottom][place~=center-x] { bottom: calc(-1.7em - var(--offset-y, 0em)) }
				&[place~=top][place~=center-x] { top: calc(-1.7em + var(--offset-y, 0em)) }
			}
		}

		body.dyslexic & & { font-size: 0.6em }

		@media (max-width: 30rem) {
			body.dyslexic & & { font-size: 0.5em }
			d-box d-text { font-size: 1.25em }
		}

		&[theme=battlemenu] d-box:not(
			[place],
			[place~=bottom],
			[place~=top]
		):has(d-sprite),
		&[theme=battlemenu] d-box[place~=bottom]:has(d-sprite) {
			bottom: -3.6em;
			d-sprite img { --size: 4.75em }
		}
	}

	&:state(compact) & {
		grid-column: 2;
		margin-inline-start: 0;
		& d-speaker::before {
			content: "(";
			color: var(--white);
		}
		& > :last-child::after { content: ")" }
	}

	&:has(> d-box:first-child) {
		gap: 0;

		d-speaker::before,
		d-box > :last-child::after { content: unset }
	}

	/* When multiple sprites are present, adjust columns */
	&:has(> d-sprite + d-sprite) {
		&:not(:state(compact)) { grid-template-columns: auto 1fr auto }
		&:state(compact) { grid-template-columns: auto auto 1fr }
	}
}
/* Talksprites */
d-sprite {
	grid-row: 1 / span 3;
	grid-column: 1;
	d-box:state(compact) & { display: contents }

	/* Center sprite */
	d-box:not(:state(compact)) & {
		display: flex;
		align-items: center;
		margin-inline-end: 1ch;
	}
	d-box:not(:state(compact)) &[speaker=Noelle] {
		img { --size: calc(var(--baseheight) - 1.75em) }
		margin-block: 0 -0.5em;
		margin-inline: -0.2em 0.1em;
	}
	d-box[theme=battlemenu]:not(:state(compact)) &[speaker=Tenna] {
		img { --size: calc(var(--baseheight) - 0.25em) }
		margin-block: -1.7em -2em;
		margin-inline: -0.25em 0;
	}

	/* When multiple sprites are present, move them to the right */
	d-box:not(:state(compact)) & + & {
		grid-column: 3;
		margin-inline-end: 0;
		margin-inline-start: 1ch;
	}

	img {
		--size: 4em;
		width: var(--size);
		height: var(--size);
		object-fit: contain;
		font-family: var(--font-condensed);
		body:not(.noanim) &[src$=".gif"] + &[src$=".png"],
		body.noanim &[src$=".gif"],
		d-box:state(compact) & { display: none }
	}

	&[format=shop] {
		font-size: 1.2em;
		@media (max-width: 30rem) { font-size: 1em }

		img {
			display: block;
			width: 100%;
			margin: 0 0.5em;
			height: auto;
			object-position: center;
			max-width: var(--basewidth);
			max-height: 8em;
		}

		&:has(+ d-box[theme=shopleft]) img { max-width: calc(var(--basewidth) - 10ch) }
		&:has(+ d-box[theme=shopright]) img { max-width: calc(var(--basewidth) - 14.2em) }

		body.compact & { display: none }
	}

}
/* Speaker labels */
d-speaker {
	color: var(--lightyellow);
	text-shadow: none;
	&::after { content: ":" }
	d-box:not([theme^=battletalk], [theme=objreact]):not(:state(compact)) &,
	d-box[theme=battletalkround]:not(:state(compact)) &:is(.tenna, .susie, .ralsei, .lancer) {
		position: absolute;
		top: 0;
		left: 0;
		font-size: 1rem;
		opacity: 0;
		pointer-events: none;
	}
	d-box:not(:state(compact)) d-sprite > & { display: none }
	d-box:state(compact) & {
		grid-column: 1;
		grid-row: 1 / span 3;
	}

	/* When multiple speakers are present, chain their tags */
	d-box:state(compact) d-sprite + d-sprite & { grid-column: 2 }
}
/* Single line of text within a dialogue box
 * Automatically formats with asterisks, fonts, and speaker icons
 */
d-text {
	grid-column: 2;
	line-height: 1.4;

	/* Compact mode only: Move d-text to end after multiple speaker tags */
	d-box:state(compact) d-sprite + d-sprite ~ & { grid-column: 3 }

	&[font=tiny] {
		font-family: var(--font-tiny);
		max-width: 10.6em;
	}

	&[font=sans] {
		font-family: var(--font-sans);
	}

	:is([theme^=obj], [theme^=power], [theme=battledesc], [theme=shopdesc]) & {
		font-family: var(--font-condensed);
	}

	:is([theme^=battletalk], [theme=caller]) & {
		font-family: var(--font-dotum);
		body.dyslexic & { font-weight: bold }
	}

	&[font=eightbit], &[font="8bit"],
	:is([theme=eightbit], [theme="8bit"]) & {
		font-family: var(--font-8bit);
	}

	[theme=prophecy] & {
		font-family: var(--font-prophecy);
		background: #42d0ff url("../assets/images/story/prophecy.png") repeat center / var(--prophecy-size) auto;
		background-clip: text;
		color: rgb(from #42d0ff r g b / 0.5);
		body:not(.noanim) & { animation: bgshift 10s linear infinite }
		body:not(.dim) & { filter: brightness(1.75) saturate(1.5) }
		body.dyslexic & { font-size: 0.66em }
	}
	body:not(.noanim) [theme=prophecy]:nth-child(odd) &:nth-child(even),
	body:not(.noanim) [theme=prophecy]:nth-child(even) &:nth-child(odd) { animation-delay: 3s }

	&[asterisk] {
		padding-inline-start: 2ch;
		text-indent: -2ch;

		&::before {
			content: "*";
			margin-inline-end: 1ch;
		}
	}

	&[asterisk="Sweet" i],
	&[asterisk="Cap'n" i], &[asterisk="Capn" i],
	&[asterisk="K_K" i], &[asterisk="KK" i],
	&[asterisk="Happy" i], &[asterisk="Nice" i],
	&[asterisk="Mad" i], &[asterisk="Mean" i],
	&[asterisk="Sad" i], &[asterisk="Shy" i] {
		position: relative;
		padding-inline-start: 1.25em;
		text-indent: unset;

		&::before {
			text-shadow: none;
			position: absolute;
			top: 0.05em;
			left: -0.35em;
			content: "";
			color: transparent;
			width: var(--size, 1.25em);
			height: var(--size, 1.25em);
			background: center / contain no-repeat;
		}
	}
	body:not(.compact) [theme^=battletalk] &:is(
		[asterisk="Happy" i], [asterisk="Nice" i],
		[asterisk="Mad" i], [asterisk="Mean" i],
		[asterisk="Sad" i], [asterisk="Shy" i]
	) {
		padding-inline-start: 0;
		&::before {
			filter: drop-shadow(0 0 2px var(--black));
			--size: 2em;
			top: -1.5em;
			left: -1.5em;
		}
	}

	&:is([asterisk="Sweet" i])::before {
		background-image: url("../assets/images/faces/sweetcapncakes/sweet.gif");
		content: "(Sweet)";
	}
	&:is([asterisk="Cap'n" i], [asterisk="Capn" i])::before {
		background-image: url("../assets/images/faces/sweetcapncakes/capn.gif");
		content: "(Cap'n)";
	}
	&:is([asterisk="K_K" i], [asterisk="KK" i])::before {
		background-image: url("../assets/images/faces/sweetcapncakes/kk.gif");
		content: "(K_K)";
	}
	body.noanim & {
		&:is([asterisk="Sweet" i])::before { background-image: url("../assets/images/faces/sweetcapncakes/sweet.png") }
		&:is([asterisk="Cap'n" i], [asterisk="Capn" i])::before { background-image: url("../assets/images/faces/sweetcapncakes/capn.png") }
		&:is([asterisk="K_K" i], [asterisk="KK" i])::before { background-image: url("../assets/images/faces/sweetcapncakes/kk.png") }
	}
	&:is([asterisk="Happy" i], [asterisk="Nice" i])::before {
		background-image: url("../assets/images/faces/clover/happy.png");
		content: "(Nice)";
	}
	&:is([asterisk="Mad" i], [asterisk="Mean" i])::before {
		background-image: url("../assets/images/faces/clover/mad.png");
		content: "(Mean)";
	}
	&:is([asterisk="Sad" i], [asterisk="Shy" i])::before {
		background-image: url("../assets/images/faces/clover/sad.png");
		content: "(Shy)";
	}

	&.hideoverflow { white-space: pre }

	img.inline {
		height: 1em;
		width: auto;
		vertical-align: text-bottom;
	}
}
@keyframes bgshift {
	0% { background-position-x: 0 }
	100% { background-position-x: var(--prophecy-size) }
}
/* Choice menus only */
d-choices {
	&:not(:state(compact)) {
		display: block;
		--side-width: 5em;
		padding: 0;
		position: relative;
		margin-block-end: 0;

		/* Heart-shaped selector icon
		To be displayed when none of the options are being considered or selected */
		&:not(:has(d-option:hover), :focus-within, :has([aria-expanded="true"])),
		&[noninteractive], &:state(forced):not(:has(d-option:hover), :focus-within) {
			&::after {
				content: "";
				background: url("../assets/images/heart.png") center / contain no-repeat;
				width: var(--size);
				height: var(--size);
				position: absolute;
				left: calc(9em + var(--offset-x, 0em));
				top: calc(1.7em + var(--offset-y, 0em));
				--size: 0.75em;
			}
			&[theme=battlemenu]::after { left: calc(11em + var(--offset-x, 0em)) }
			&:is([theme=eightbit], [theme="8bit"])::after {
				background-image: url("../assets/images/heart_8bit.png");
				--size: 0.7em;
				top: calc(1.85em + var(--offset-y, 0em));
			}
		}
	}

	/* Option sizing WITHIN a menu (fullsize mode) */
	d-option {
		width: max-content;
		position: absolute;
		line-height: 1.2;

		/* Left/right */
		&[index="0"], &[index="1"] {
			top: calc(50% + var(--option-offset-y, 0em));
			transform: translateY(-50%);
		}
		/* Up/down */
		&[index="2"], &[index="3"] {
			left: calc(50% + var(--option-offset-x, 0em));
			transform: translateX(-50%);
			z-index: 1;
		}

		&[index="0"] { left: calc(1.24em + var(--option-offset-x, 0em)); z-index: 0 }
		&[index="1"] { right: calc(0.15em - var(--option-offset-x, 0em)); z-index: 2 }
		&[index="2"] { top: calc(-0.1em + var(--option-offset-y, 0em)) }
		&[index="3"] { bottom: calc(-0.2em - var(--option-offset-y, 0em)) }
	}

	/* For 8-bit choice menus with at most 2 children, scrunch the kids together */
	&:is([theme=eightbit], [theme="8bit"]):has(> :nth-child(1):last-child, > :nth-child(2):last-child) d-option {
		&[index="0"] { left: 4.74em }
		&[index="1"] { right: 4.65em }
	}

	/* Asterisk marker */
	.conditional {
		position: absolute;
		left: calc(100% + 0.2em);
		top: 0;
	}

	/* In compact mode, all the options get moved alongside their tabs; hide the resulting empty menu */
	&:state(compact) { display: none }
}
/* Options in choice menus */
d-option {
	display: block;
	font-family: var(--font-condensed);

	/* Selectable options */
	d-choices:not([noninteractive]) &,
	:not(d-choices) > &:has(+ d-option-panel) {
		cursor: pointer;

		&:hover, &:focus,
		&[aria-expanded=true] {
			color: var(--yellow);
		}
		/* Heart-shaped hover indicator */
		&::before {
			content: "";
			background: center / contain no-repeat;
			width: var(--size);
			height: var(--size);
			position: absolute;
			left: -0.5em;
			top: calc(50% - (0.55 * var(--size)));
			--size: 0.75em;
		}
		&:is(:hover, :focus)::before,
		&[aria-expanded=true]::before {
			background-image: url("../assets/images/heart.png");
		}
	}

	/* Adjust placement of heart-shaped hover indicator inside choice menus */
	d-choices:not([noninteractive]) &::before {
		left: -1.75ch;
		top: 0.15em;
	}

	/* Adjust in 8-bit menus */
	d-choices:is([theme=eightbit], [theme="8bit"]) &,
	&:is([theme=eightbit], [theme="8bit"]) {
		font-family: var(--font-8bit);
		&:is(:hover, :focus)::before,
		&[aria-expanded=true]::before {
			background-image: url("../assets/images/heart_8bit.png");
		}
	}
	d-choices:is([theme=eightbit], [theme="8bit"]):not([noninteractive]) &::before { left: -1.4ch }

	/* Hide the hearts/highlights when choices are forced open */
	d-choices:state(forced) &:not(:hover, :focus) {
		color: var(--white);
		&::before { content: unset }
	}

	/* Non-selectable options */
	d-choices[noninteractive] &,
	/* Options with no linked panels */
	:not(d-choices) > &:not(:has(+ d-option-panel)) {
		cursor: not-allowed;
	}

	/* Compact mode */
	:not(d-choices) > & {
		position: relative;
		border: var(--border-width) solid transparent;
		border-block-width: calc(var(--border-width) * 0.5);
		border-image: url("../assets/images/ui/textbox/light_transparent.png") 16 / var(--border-width) / calc(0.25 * var(--border-width));
		body.dim & { border-image-source: url("../assets/images/ui/textbox/light_transparent_dim.png") }
		/* Spacing */
		margin: 0.3em;
		d-option-panel:state(collapsed) + & { margin-block-start: 0 }	/* Let the previous option handle spacing between options */
		&:has(+ d-option-panel:state(collapsed) + :not(d-option)),
		&:has(+ d-option-panel:state(collapsed):last-child) { margin-block-end: 0 }	/* For the last option in a menu, let the next element handle spacing between this option and that */
		/* Heart-shaped hover indicator */
		padding-inline-start: 0.8em;
		&::before { --size: 0.6em }

		.conditional {
			float: inline-end;
		}
	}

	/* Asterisk marker */
	.conditional {
		color: var(--gray);
		padding: 0.5em;
		margin: -0.5em;
		cursor: help;
	}

	body.compact & :is(.hide, .break) { display: none }
}
/* Panel containing the result of choosing an option in a choice menu */
d-option-panel {
	display: block;

	/* Last panel handles the end margin for <d-choices> */
	body:not(.compact) &:has(+ :not(&)),
	body:not(.compact) &:last-child {
		margin-block-end: 0.2em;
	}

	&:not([hidden]) {
		border: var(--border-width) solid transparent;
		border-image: url("../assets/images/ui/textbox/light_transparent.png") 16 / var(--border-width);
		body.dim &:not([theme]), body.dim &[theme=light] { border-image-source: url("../assets/images/ui/textbox/light_transparent_dim.png") }
		&[theme=dark] { border-image-source: url("../assets/images/ui/textbox/dark_transparent.gif") }
		body.dim &[theme=dark] { border-image-source: url("../assets/images/ui/textbox/dark_transparent_dim.gif") }

		/* Spacing */
		padding: 0.1em;
		margin: 0;
		body:not(.compact) &:not(:state(collapsed)) { margin-block-start: 0.2em }
		body:not(.compact) & { margin-inline-start: min(1.2em, 3vw) }
		body.compact & { margin-inline-start: min(0.8em, 2vw) }
	}

	/* Expanded mode: hide collapsed panels, and labels when panels aren't forced */
	body:not(.compact) &:not(:state(forced)) .selection-label,
	/* Compact mode: hide collapsed panels, and labels regardless (the toggles will act as labels instead) */
	body.compact & .selection-label {
		display: none;
	}

	.selection-label {
		color: var(--gray);
		font-style: italic;
		font-family: var(--font-condensed);

		.break { display: none }
	}

	/* First child will always be selection-label */
	& > :nth-child(2) { margin-block-start: 0 !important }
	& > :last-child { margin-block-end: 0 !important }
}
/* For simultaneous talk bubbles in encounters */
.boxgroup {
	display: flex;
	flex-wrap: wrap;
	& > d-box { margin-inline-start: 0 !important }

	&:has(
		[theme^=battletalk] :is(
			[asterisk="Happy" i], [asterisk="Nice" i],
			[asterisk="Mad" i], [asterisk="Mean" i],
			[asterisk="Sad" i], [asterisk="Shy" i]
		)
	) {
		margin-block-start: 0.75em;
	}

	body:not(.compact) & {
		margin-inline-start: 1em;
	}

	body.compact & {
		margin-inline-start: min(1em, 3vw);
		gap: 0 min(1em, 3vw);
		&:has(> :nth-child(2))::before,
		&:has(> :nth-child(3))::after {
			content: "/";
			color: gray;
		}
		& > :first-child { order: 0 }
		&::before { order: 1 }
		& > :nth-child(2) { order: 2 }
		&::after { order: 3 }
		& > :nth-child(3) { order: 4 }
	}
}
/* Winglade encounter dialogue */
@keyframes rotate {
	0% { transform: rotate(0deg) }
	100% { transform: rotate(360deg) }
}
.winglade {
	--size: 12em;
	width: var(--size);
	height: var(--size);
	font-family: var(--font-dotum);
	body.dyslexic & { font-weight: bold }
	body:not(.noanim) & { animation: rotate 15s linear infinite }
}
/* #region POWER menu */
.powerstats, .powerspells {
	font-family: var(--font-condensed);
	line-height: 1.2;
	display: grid;
	align-items: center;

	body:not(.compact) & {
		font-size: 1.2em;
		padding: 0.1em 0.2em;
		border: var(--border-width) solid transparent;
		border-image: url("../assets/images/ui/textbox/dark.gif") 16 / var(--border-width);
		background-color: var(--black);
		background-clip: padding-box;

		position: relative;
		&::before {
			content: "";
			display: block;
			position: absolute;
			top: calc(-0.975 * var(--border-width));
			left: 0;
			width: 100%;
			height: 0.75em;
		}
	}
	body:not(.compact).dim & { border-image-source: url("../assets/images/ui/textbox/dark_dim.gif") }
	
	body.compact & { margin: 0 0 0 min(1em, 3vw) }
}
/* Party members' stat menus */
.powerstats {
	width: fit-content;
	grid-template-columns: 11.5ch 3ch;

	body:not(.compact) & {
		&::before { background: url("../assets/images/ui/statmenu/stats.png") center / contain no-repeat }
		dt:has(
			img[src*=guts], /* Guts */
			+ dd > img[src*=dog_sleep] /* Dog */
		) .statlabel::after { content: ":" }
	}
	body:not(.compact).dim &::before { background-image: url("../assets/images/ui/statmenu/stats_dim.png") }
	
	body.compact & {
		gap: 0 1ch;
		.statlabel:not(.blank)::after { content: ":" }
	}

	dt {
		grid-column: 1;
		display: grid;
		grid-template-columns: 1.75ch auto;
		gap: 0.5ch;
		align-items: center;
	}
	.statlabel {
		grid-column: 2;

		&.blank { color: hsl(from var(--white) h s calc(l / 4)) } /* specifically, it uses c_dkgray which is #404040; we're matching that relatively so as not to have to introduce a new color */

		&.shrink80 {
			transform-origin: top left;
			transform: scaleX(80%);
		}
	}

	dd {
		grid-column: 2;
		margin: 0;
		&:has(.staticon) {
			display: flex;
			align-items: center;
		}
		&:has(.staticon[src*=guts]) { margin-inline-start: -3ch }
	}

	dt .staticon, img[src*=dog_sleep] { width: 100% }
	dt .staticon[src*=grass] { width: 80% }
	img[src*=dog_sleep] {
		transform-origin: center right;
		transform: scale(140%);
	}
	.staticon {
		&.noicon {
			grid-column: 1;
			text-align: center;
		}
		dd & {
			width: 1.65ch;
			height: auto;
		}
		body.dim & { filter: brightness(73%) }
	}
}
/* Party members' spell menus */
.powerspells {
	width: calc(var(--basewidth) - 11.4em);
	max-width: calc(100% - var(--border-width));
	color: hsl(from var(--white) h s calc(l / 2));

	position: relative;
	&::after {
		content: "";
		display: block;
		position: absolute;
		top: -0.5ch;
		left: 2.25ch;
		width: 2ch;
		height: 1ch;
		background: url("../assets/images/ui/statmenu/tp.png") top left / contain no-repeat;
	}
	body.compact &::after { left: 2ch }
	body.dim &::after { background-image: url("../assets/images/ui/statmenu/tp_dim.png") }

	body:not(.compact) &::before { background: url("../assets/images/ui/statmenu/spells.png") center / contain no-repeat }
	body:not(.compact).dim &::before { background-image: url("../assets/images/ui/statmenu/spells_dim.png") }

	tr {
		display: grid;
		padding-inline-start: 2ch;
		grid-template-columns: 4ch 1fr;
		gap: 0 1ch;
	}
	.spellcost {
		grid-column: 1;
		grid-row: 1;
		position: relative;

		.variable {
			position: absolute;
			top: 0;
			right: 4.75ch;
			cursor: help;
			color: var(--gray);
		}
	}
	.spellname {
		grid-column: 2;
		grid-row: 1;
		a:not(:hover, :focus) {
			color: inherit;
			text-decoration: none;
		}
	}
}
/* #endregion */
/* Character icons for ACTs */
.acticon {
	height: 0.75em;
	width: auto;
	vertical-align: baseline;
	margin-inline-end: 0.2ch;
}
/* Character profiles from the Recruits menu */
.profile {
	font-family: var(--font-condensed);
	body:not(.compact) & {
		display: grid;
		align-items: center;
		background-color: var(--black);
		border: var(--border-width) solid transparent;
		border-image: url("../assets/images/ui/textbox/light.png") 16 / var(--border-width);
		font-size: 1.2em;
		max-width: 35em;
		margin-inline: auto;

		@media (min-width: 30rem) {
			grid-template-columns: 1fr auto;
			h3 { grid-column: 1 }
			.chapter {
				grid-column: 2;
				text-align: right;
				margin-block-end: 0;
				transform-origin: center right;
			}
			.desc { grid-column: 1 / span 2 }
			.stats-text { grid-column: 1 }
			.stats-num {
				text-align: right;
				grid-column: 2;
				transform: scaleX(50%);
				transform-origin: center right;

				.stat {
					display: flex;
					column-gap: 1ch;
					justify-content: end;
				}

				dd { min-width: 3ch }
			}
		}
		@media (max-width: 30rem) {
			.chapter { transform-origin: center left }
			.stats-num {
				display: grid;
				grid-template-columns: auto 1fr;
				column-gap: 1ch;
				dt { transform-origin: center left }
				.stat:nth-child(2) dt { transform: scaleX(83%) }
				.stat:nth-child(3) dt { transform: scaleX(71%) }
				.stat:nth-child(4) dt { transform: scaleX(70%) }
			}
			.stat { display: contents }
		}

		.stats-text {
			display: grid;
			grid-template-columns: auto 1fr;
			column-gap: 1ch;

			dt:nth-of-type(2) {
				transform: scaleX(70%);
				transform-origin: center left;
			}
		}

		.chapter {
			grid-row: 1;
			transform: scaleX(50%);
		}

		.desc { max-width: calc(var(--basewidth) - 3.4em) }

		dd { margin: 0 }
	}
	body:not(.compact).dim & { border-image-source: url("../assets/images/ui/textbox/light_dim.png") }

	body.compact & {
		dd { margin-inline-start: 3ch }
	}

	h3 {
		font-size: 1.2em;
		margin-block: 0;
	}
	.chapter {
		text-transform: uppercase;
		margin-block-start: 0;
	}
	.desc {
		font-size: 0.9em;
		font-family: var(--font-dotum);
		body.dyslexic & { font-weight: bold }
		margin-block: 0.5em 1em;
		word-break: keep-all;
	}

	dl { margin-block: 0 }

	dt { text-transform: uppercase }
}
/* Malius' fusion list */
.fusionlist {
	display: block;
	background-color: var(--black);
	border: var(--border-width) solid transparent;
	border-image: url("/deltascript/assets/images/ui/textbox/light.png") 16 / var(--border-width);
	body.dim & { border-image-source: url("/deltascript/assets/images/ui/textbox/light_dim.png") }
	font-size: 1.2em;
	font-family: var(--font-condensed);
	width: 100%;
	max-width: 30em;
	margin-inline: auto;

	thead, tbody { display: contents }

	tr {
		display: grid;
		grid-template-columns: 1fr 1fr;
		max-width: 20em;
		margin-inline: auto;
		--row-padding: 0.5em;
		tbody &:has(th:first-child) {
			padding-block-start: var(--row-padding);
			border-block-start: 0.2em solid var(--white);
		}
		&:has(th:last-child, td:only-child) { padding-block-end: var(--row-padding) }
	}

	th {
		text-align: start;
		font-weight: normal;
	}

	td:first-child { grid-column: 2 }

	a:not(:hover, :focus) { text-decoration: none }
}
/* TV World - Ball Machine - gacha menu */
.gachamenu {
	line-height: 1.2;
	width: fit-content;
	display: grid;
	grid-template-columns: auto auto;
	gap: 0 2ch;

	body:not(.compact) & {
		font-size: 1.2em;
		background-color: var(--black);
		background-clip: padding-box;
		border: solid transparent var(--border-width);
		border-image: url("../assets/images/ui/textbox/dark.gif") 16 / var(--border-width)
	}
	body:not(.compact).dim & { border-image-source: url("../assets/images/ui/textbox/dark_dim.gif") }

	tbody, tr { display: contents }

	.lightyellow { color: var(--lightyellow-gacha) }

	th {
		font-weight: normal;
		text-align: end;
	}

	tr:nth-child(2) td { margin-block-end: 1.2em }
	td:nth-child(2) { text-align: end }

	td:only-child {
		grid-column: 1 / span 2;
		text-align: center;
		display: flex;
		justify-content: center;
		align-items: center;
		height: 2.4em;
	}

	svg {
		color: #808080;
		width: 1ch;
		padding-inline-end: calc(1ch * 0.125);
		height: auto;
	}
}
/* Tenna's text sprites */
@keyframes funnyshake {
	0% { transform: translate(0, 0) }
	10% { transform: translate(1px, 1px) }
	20% { transform: translate(1px, -1px) }
	30% { transform: translate(0, 1px) }
	40% { transform: translate(0, 0) }
	50% { transform: translate(-1px, -1px) }
	60% { transform: translate(-1px, 0) }
	70% { transform: translate(0, -1px) }
	80% { transform: translate(0, 0) }
	90% { transform: translate(-1px, 1px) }
}
funny-text {
	display: contents;

	button {
		background: none;
		border: none;
		font: inherit;
		color: inherit;
		cursor: pointer;
	}
	button, figure {
		display: inline-block;
		padding: 0;
		margin: 0;
	}
	& > :is(button, figure) { position: relative }
	&:not(.fullwidth) > :is(button, figure) { width: var(--width, 100%) }
	&.fullwidth > :is(button, figure) { width: 100% }
	img {
		user-select: text;
		display: block;

		/* Full height/width positioning */
		.left & { object-position: left }
		.center & { object-position: center }
		.right & { object-position: right }

		body:not(.noanim) &.shaking {
			animation-name: funnyshake;
			animation-duration: 0.3333s;
			animation-timing-function: steps(10, jump-none);
			animation-iteration-count: infinite;
		}
	}
	figcaption {
		color: transparent;
		font-family: var(--font-condensed);
		text-shadow: none;
		user-select: none;
	}

	body:not(.compact) & {
		& > :is(button, figure) {
			top: var(--offset-y, 0em);
			margin-inline-start: var(--offset-x, 0em);
		}
		img {
			width: var(--width, 100%);
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: auto;
			margin-block: -0.25em;

			.fullheight & {
				height: calc(var(--baseheight) - 1.7em);
				object-fit: contain;
			}
		}

		/* Conspiratorial whispers: Two lines */
		&:is([name=alligator], [name=city_feet], [name=gentle]) > :is(button, figure) { vertical-align: top }
	}

	body.compact & {
		--img-height: 2.5em;

		button, figure {
			vertical-align: baseline;
			height: var(--img-height);
			width: fit-content;
			margin: -0.3em 0 -0.7em;
		}
		img {
			height: var(--img-height);
			width: auto;
			object-fit: contain;
		}
		figcaption {
			position: absolute;
			top: 0;
			left: 0;
		}

		/* Conspiratorial whispers: Any length */
		&:is([name=coffee], [name=know_tv], [name=tan], [name=alligator], [name=city_feet], [name=gentle]) {
			vertical-align: top;
			top: 0.4em;
		}
		/* Conspiratorial whispers: One line */
		&:is([name=coffee], [name=know_tv], [name=tan]) { --img-height: 1.125em }
		/* Conspiratorial whispers: Two lines */
		&:is([name=alligator], [name=city_feet], [name=gentle]) {
			--img-height: 2.25em;
			margin-block-end: 0.4em;
		}
	}

	/* Special styling for the introductory "AMAZING" funny text */
	d-text:has(&[name=amazing_01]) {
		body:not(.compact) & { position: relative }
		body.compact & .hide { display: none }
	}
	&[name=amazing_01] button {
		position: absolute;
		--offset-y: -0.4em;
		--offset-x: 0.5ch;
	}
}
/* #endregion */